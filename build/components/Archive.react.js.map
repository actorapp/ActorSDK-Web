{"version":3,"sources":["../../src/components/Archive.react.js"],"names":[],"mappings":"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","file":"Archive.react.js","sourcesContent":["/*\n * Copyright (C) 2016 Actor LLC. <https://actor.im>\n */\n\nimport { map, debounce } from 'lodash';\nimport React, { Component, PropTypes } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Container } from 'flux/utils';\nimport classnames from 'classnames';\nimport { Link } from 'react-router';\n\nimport ArchiveActionCreators from '../actions/ArchiveActionCreators';\n\nimport ArchiveStore from '../stores/ArchiveStore';\n\nimport AvatarItem from './common/AvatarItem.react';\nimport ConnectionState from './common/ConnectionState.react';\nimport Scrollbar from './common/Scrollbar.react';\n\nclass Archive extends Component {\n  constructor(props){\n    super(props);\n  }\n\n  static getStores = () => [ArchiveStore];\n\n  static calculateState() {\n    return {\n      isLoading: ArchiveStore.isArchiveLoading(),\n      isInitialLoadingComplete: ArchiveStore.isInitialLoadingComplete(),\n      isAllLoaded: ArchiveStore.isAllLoaded(),\n      dialogs: ArchiveStore.getDialogs()\n    }\n  };\n\n  static contextTypes = {\n    intl: PropTypes.object\n  };\n\n  componentWillMount() {\n    ArchiveActionCreators.loadArchivedDialogs();\n  }\n\n  componentDidUpdate() {\n    const { isInitialLoadingComplete, isAllLoaded, isLoading } = this.state;\n    if (isInitialLoadingComplete && !isAllLoaded && !isLoading) {\n      const scrollNode = findDOMNode(this.refs.archiveScroll);\n      const scrollContent = scrollNode.getElementsByClassName('ss-content')[0];\n      if (scrollContent.scrollHeight < scrollNode.scrollHeight) {\n        setImmediate(() => {\n          ArchiveActionCreators.loadMoreArchivedDialogs();\n        });\n      }\n    }\n  }\n\n  loadArchiveByScroll = debounce(() => {\n    const { isAllLoaded, isLoading } = this.state;\n    const threshold = 100;\n    if (!isLoading && !isAllLoaded) {\n      const scrollNode = findDOMNode(this.refs.archiveScroll);\n      const scrollArea = scrollNode.getElementsByClassName('ss-scrollarea')[0];\n\n      if (scrollNode.scrollHeight + scrollArea.scrollTop > scrollArea.scrollHeight - threshold) {\n        ArchiveActionCreators.loadMoreArchivedDialogs();\n      }\n    }\n  }, 5, {maxWait: 30});\n\n  render() {\n    const { isLoading, dialogs, isAllLoaded } = this.state;\n    const archiveClassname = classnames('archive-section', {\n      'archive-section--loading': isLoading\n    });\n\n    const dialogsList = map(dialogs, (dialog, index) => {\n      const { counter, peer } = dialog;\n\n      return (\n        <div className=\"archive-section__list__item col-xs-12 col-sm-6 col-md-4 col-lg-3\" key={index}>\n          <Link to={`/im/${peer.peer.key}`} className=\"archive-item row\">\n            <div className=\"archive-item__avatar\">\n              <AvatarItem image={peer.avatar}\n                          placeholder={peer.placeholder}\n                          size=\"medium\"\n                          title={peer.title}/>\n              {\n                counter !== 0\n                  ? <div className=\"archive-item__counter\">{counter}</div>\n                  : null\n              }\n            </div>\n            <div className=\"col-xs\">\n              <h4 className=\"archive-item__title\">{peer.title}</h4>\n            </div>\n          </Link>\n        </div>\n      )\n    });\n\n    return (\n      <section className=\"main\">\n        <header className=\"toolbar row\">\n          <h3>Archive</h3>\n        </header>\n        <ConnectionState/>\n        <div className=\"flexrow\">\n          <section className={archiveClassname}>\n            <Scrollbar ref=\"archiveScroll\" onScroll={this.loadArchiveByScroll}>\n              <div className=\"archive-section__list row\">\n                {\n                  dialogs.length !== 0\n                    ? dialogsList\n                    : !isLoading\n                        ? <div className=\"archive-section__list__item archive-section__list__item--empty col-xs-12\">\n                            <h3>No dialogs in archive</h3>\n                          </div>\n                        : null\n                }\n                {\n                  isLoading\n                    ? <div className=\"archive-section__list__item archive-section__list__item--loading col-xs-12 col-sm-6 col-md-4 col-lg-3\">\n                        <div className=\"preloader\"><div/><div/><div/><div/><div/></div>\n                      </div>\n                    : null\n                }\n              </div>\n            </Scrollbar>\n          </section>\n        </div>\n      </section>\n    );\n  }\n}\n\nexport default Container.create(Archive, {pure: false});\n"]}