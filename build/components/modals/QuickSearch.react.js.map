{"version":3,"sources":["../../../src/components/modals/QuickSearch.react.js"],"names":[],"mappings":";;;;AAIA;;AAEA;;;;AACA;;AACA;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;AAEA;;;;AACA;;;;AAEA;;;;AAEA;;;;;;;;;;;;;;AAEA,IAAM,qBAAqB,EAArB;AACN,IAAI,cAAc,CAAd;;IAEE;;;AACJ,WADI,WACJ,CAAY,KAAZ,EAAmB;0BADf,aACe;;iDACjB,sBAAM,KAAN,GADiB;;UA6BnB,WAAW,YAAM;AACf,mBAAa,YAAM;AACjB,mCAAY,MAAK,IAAL,CAAU,KAAV,CAAZ,CAA6B,KAA7B,GADiB;OAAN,CAAb,CADe;KAAN,CA7BQ;;UAmCnB,cAAc;aAAM,oCAA0B,IAA1B;KAAN,CAnCK;;UAqCnB,eAAe,UAAC,KAAD,EAAW;AACxB,UAAM,QAAQ,MAAM,MAAN,CAAa,KAAb,CADU;AAExB,YAAK,QAAL,CAAc,EAAC,YAAD,EAAd,EAFwB;AAGxB,0CAA0B,MAA1B,CAAiC,KAAjC,EAHwB;KAAX,CArCI;;UA2CnB,qBAAqB,UAAC,IAAD,EAAU;AAC7B,UAAM,UAAU,oBAAU,YAAV,CAAuB,IAAvB,CAAV,CADuB;AAE7B,wBAAQ,IAAR,UAAoB,OAApB,EAF6B;AAG7B,YAAK,WAAL,GAH6B;KAAV,CA3CF;;UAiDnB,gBAAgB,UAAC,KAAD,EAAW;wBACU,MAAK,KAAL,CADV;UACjB,8BADiB;UACR,0CADQ;;AAEzB,UAAM,eAAe,CAAf,CAFmB;AAGzB,UAAI,QAAQ,aAAR,CAHqB;;AAKzB,cAAQ,MAAM,OAAN;AACN,aAAK,4BAAS,KAAT;AACH,gBAAM,eAAN,GADF;AAEE,gBAAM,cAAN,GAFF;AAGE,gBAAK,kBAAL,CAAwB,QAAQ,aAAR,EAAuB,QAAvB,CAAgC,IAAhC,CAAxB,CAHF;AAIE,gBAJF;;AADF,aAOO,4BAAS,QAAT;AACH,gBAAM,eAAN,GADF;AAEE,gBAAM,cAAN,GAFF;;AAIE,cAAI,QAAQ,CAAR,EAAW;AACb,qBAAS,CAAT,CADa;WAAf,MAEO,IAAI,UAAU,CAAV,EAAa;AACtB,oBAAQ,QAAQ,MAAR,GAAiB,CAAjB,CADc;WAAjB;;AAIP,cAAI,cAAc,KAAd,EAAqB;AACvB,0BAAc,KAAd,CADuB;WAAzB,MAEO,IAAI,UAAU,QAAQ,MAAR,GAAiB,CAAjB,EAAoB;AACvC,0BAAc,QAAQ,MAAR,GAAiB,YAAjB,CADyB;WAAlC;;AAIP,gBAAK,YAAL,CAAkB,cAAc,kBAAd,CAAlB,CAhBF;AAiBE,gBAAK,QAAL,CAAc,EAAC,eAAe,KAAf,EAAf,EAjBF;AAkBE,gBAlBF;AAPF,aA0BO,4BAAS,UAAT,CA1BP;AA2BE,aAAK,4BAAS,GAAT;AACH,gBAAM,eAAN,GADF;AAEE,gBAAM,cAAN,GAFF;;AAIE,cAAI,QAAQ,QAAQ,MAAR,GAAiB,CAAjB,EAAoB;AAC9B,qBAAS,CAAT,CAD8B;WAAhC,MAEO,IAAI,UAAU,QAAQ,MAAR,GAAiB,CAAjB,EAAoB;AACvC,oBAAQ,CAAR,CADuC;WAAlC;;AAIP,cAAI,QAAQ,CAAR,GAAY,cAAc,YAAd,EAA4B;AAC1C,0BAAc,QAAQ,CAAR,GAAY,YAAZ,CAD4B;WAA5C,MAEO,IAAI,UAAU,CAAV,EAAa;AACtB,0BAAc,CAAd,CADsB;WAAjB;;AAIP,gBAAK,YAAL,CAAkB,cAAc,kBAAd,CAAlB,CAhBF;AAiBE,gBAAK,QAAL,CAAc,EAAC,eAAe,KAAf,EAAf,EAjBF;AAkBE,gBAlBF;;AA3BF,aA+CO,4BAAS,GAAT;AACH,gBAAM,cAAN,GADF;AAEE,gBAAK,WAAL,GAFF;AAGE,gBAHF;;AA/CF;OALyB;KAAX,CAjDG;;UA8GnB,eAAe,UAAC,GAAD;aAAS,MAAK,IAAL,CAAU,OAAV,CAAkB,QAAlB,CAA2B,GAA3B;KAAT,CA9GI;;UAgHnB,sBAAsB,UAAC,KAAD,EAAW;AAC/B,UAAM,QAAQ,2BAAY,MAAK,IAAL,CAAU,KAAV,CAApB,CADyB;AAE/B,UAAM,YAAY,MAAM,qBAAN,EAAZ,CAFyB;AAG/B,UAAM,SAAS;AACb,WAAG,MAAM,KAAN,IAAe,MAAM,OAAN;AAClB,WAAG,MAAM,KAAN,IAAe,MAAM,OAAN;OAFd,CAHyB;;AAQ/B,UAAI,CAAC,wBAAS,MAAT,EAAiB,SAAjB,CAAD,EAA8B;AAChC,cAAK,WAAL,GADgC;OAAlC;KARoB,CAhHH;;;GAAnB;;AADI,cAOG,2CAAiB;AACtB,WAAO;AACL,cAAQ,2BAAiB,MAAjB,EAAR;AACA,eAAS,2BAAiB,UAAjB,EAAT;AACA,qBAAe,CAAf;KAHF,CADsB;;;AAPpB,wBAmBJ,iDAAoB;AAClB,SAAK,QAAL,GADkB;AAElB,aAAS,gBAAT,CAA0B,SAA1B,EAAqC,KAAK,aAAL,EAAoB,KAAzD,EAFkB;AAGlB,aAAS,gBAAT,CAA0B,OAA1B,EAAmC,KAAK,mBAAL,EAA0B,KAA7D,EAHkB;;;AAnBhB,wBAyBJ,uDAAuB;AACrB,aAAS,mBAAT,CAA6B,SAA7B,EAAwC,KAAK,aAAL,EAAoB,KAA5D,EADqB;AAErB,aAAS,mBAAT,CAA6B,OAA7B,EAAsC,KAAK,mBAAL,EAA0B,KAAhE,EAFqB;;;AAzBnB,wBA8HJ,2BAAS;;;iBAC2C,KAAK,KAAL,CAD3C;QACC,uBADD;QACS,yBADT;QACkB,qCADlB;QACiC,qBADjC;QAEC,OAAS,KAAK,OAAL,CAAT,KAFD;;;AAIP,QAAM,cAAc,iBAAI,OAAJ,EAAa,UAAC,MAAD,EAAS,KAAT,EAAmB;AAClD,UAAM,kBAAkB,0BAAW,mBAAX,EAAgC;AACtD,iCAAyB,kBAAkB,KAAlB;OADH,CAAlB,CAD4C;;AAKlD,aACE;;UAAI,WAAW,eAAX;AACA,eAAK,KAAL;AACA,mBAAS;mBAAM,OAAK,kBAAL,CAAwB,OAAO,QAAP,CAAgB,IAAhB;WAA9B;AACT,uBAAa;mBAAM,OAAK,QAAL,CAAc,EAAC,eAAe,KAAf,EAAf;WAAN,EAHjB;QAIE,sDAAY,OAAO,OAAO,QAAP,CAAgB,MAAhB;AACP,uBAAa,OAAO,QAAP,CAAgB,WAAhB;AACb,gBAAK,OAAL;AACA,iBAAO,OAAO,QAAP,CAAgB,KAAhB,EAHnB,CAJF;QAQE;;YAAK,WAAU,cAAV,EAAL;UACE;;cAAK,WAAU,iBAAV,EAAL;YAAkC,KAAK,QAAL,CAAc,8BAAd,CAAlC;WADF;UAEG,OAAO,QAAP,CAAgB,KAAhB;SAVL;OADF,CALkD;KAAnB,CAA3B,CAJC;;AA0BP,QAAM,aAAa;AACjB,eAAU;AACR,kBAAU,IAAV;AACA,aAAK,IAAL;AACA,cAAM,IAAN;AACA,eAAO,IAAP;AACA,gBAAQ,IAAR;AACA,gBAAQ,IAAR;AACA,oBAAY,IAAZ;AACA,kBAAU,IAAV;AACA,iBAAS,IAAT;AACA,iBAAS,IAAT;AACA,sBAAc,IAAd;AACA,eAAO,GAAP;OAZF;KADI,CA1BC;;AA2CP,WACE;;QAAO,WAAU,2BAAV;AACA,wBAAgB,GAAhB;AACA,gBAAQ,MAAR;AACA,eAAO,UAAP,EAHP;MAIE;;UAAK,KAAI,OAAJ,EAAL;QAEE;;YAAQ,WAAU,QAAV,EAAR;UACE;;cAAK,WAAU,WAAV,EAAL;YAA4B,KAAK,QAAL,CAAc,yBAAd,CAA5B;WADF;UAEE;;cAAK,WAAU,YAAV,EAAL;YAA4B;;;;aAA5B;;YAAwD,KAAK,QAAL,CAAc,2BAAd,CAAxD;WAFF;UAGE;;cAAK,WAAU,YAAV,EAAL;YAA4B;;;;aAA5B;;YAAsD,KAAK,QAAL,CAAc,4BAAd,CAAtD;WAHF;UAIE;;cAAK,WAAU,YAAV,EAAL;YAA4B;;;;aAA5B;;YAAgE;;;;aAAhE;YAAkF;;;;aAAlF;;YAA4G,KAAK,QAAL,CAAc,8BAAd,CAA5G;WAJF;SAFF;QASE;;YAAK,WAAU,OAAV,EAAL;UACE,yCAAO,MAAK,MAAL;AACA,yBAAa,KAAK,QAAL,CAAc,+BAAd,CAAb;AACA,sBAAU,KAAK,YAAL;AACV,mBAAO,KAAP;AACA,iBAAI,OAAJ,EAJP,CADF;SATF;QAiBE;;YAAW,OAAO,EAAC,QAAQ,qBAAqB,CAArB,EAAhB,EAAyC,KAAI,SAAJ,EAApD;UACE;;cAAI,WAAU,SAAV,EAAJ;YAEI,YAAY,MAAZ,GAAqB,CAArB,GACI,WADJ,GAEI;;gBAAI,WAAU,6CAAV,EAAJ;cACE,iEAAsB,IAAG,4BAAH;AACA,wBAAQ,EAAC,YAAD,EAAR,EADtB,CADF;cAGE;;kBAAQ,WAAU,2BAAV,EAAR;;gBAAiE,KAAjE;eAHF;aAFJ;WAHN;SAjBF;OAJF;KADF,CA3CO;;;SA9HL;;;YAKG,YAAY;SAAM;CAAN;;AALf,YAeG,eAAe;AACpB,QAAM,iBAAU,MAAV;;kBAmMK,iBAAU,MAAV,CAAiB,WAAjB,EAA8B,EAAC,MAAM,KAAN,EAA/B","file":"QuickSearch.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { map } from 'lodash';\n\nimport React, { Component, PropTypes } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Container } from 'flux/utils';\nimport { FormattedMessage, FormattedHTMLMessage } from 'react-intl';\nimport Modal from 'react-modal';\nimport classnames from 'classnames';\nimport isInside from '../../utils/isInside';\nimport history from '../../utils/history';\nimport PeerUtils from '../../utils/PeerUtils';\nimport Scrollbar from '../common/Scrollbar.react';\n\nimport { KeyCodes } from '../../constants/ActorAppConstants';\n\nimport QuickSearchActionCreators from '../../actions/QuickSearchActionCreators';\nimport DialogActionCreators from '../../actions/DialogActionCreators';\n\nimport QuickSearchStore from '../../stores/QuickSearchStore';\n\nimport AvatarItem from '../common/AvatarItem.react';\n\nconst RESULT_ITEM_HEIGHT = 44;\nlet scrollIndex = 0;\n\nclass QuickSearch extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  static getStores = () => [QuickSearchStore];\n\n  static calculateState() {\n    return {\n      isOpen: QuickSearchStore.isOpen(),\n      results: QuickSearchStore.getResults(),\n      selectedIndex: 0\n    }\n  }\n\n  static contextTypes = {\n    intl: PropTypes.object\n  };\n\n  componentDidMount() {\n    this.setFocus();\n    document.addEventListener('keydown', this.handleKeyDown, false);\n    document.addEventListener('click', this.handleDocumentClick, false);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeyDown, false);\n    document.removeEventListener('click', this.handleDocumentClick, false);\n  }\n\n  setFocus = () => {\n    setImmediate(() => {\n      findDOMNode(this.refs.query).focus();\n    });\n  };\n\n  handleClose = () => QuickSearchActionCreators.hide();\n\n  handleSearch = (event) => {\n    const query = event.target.value;\n    this.setState({query});\n    QuickSearchActionCreators.search(query);\n  };\n\n  handleDialogSelect = (peer) => {\n    const peerStr = PeerUtils.peerToString(peer);\n    history.push(`/im/${peerStr}`);\n    this.handleClose();\n  };\n\n  handleKeyDown = (event) => {\n    const { results, selectedIndex } = this.state;\n    const visibleItems = 8;\n    let index = selectedIndex;\n\n    switch (event.keyCode) {\n      case KeyCodes.ENTER:\n        event.stopPropagation();\n        event.preventDefault();\n        this.handleDialogSelect(results[selectedIndex].peerInfo.peer);\n        break;\n\n      case KeyCodes.ARROW_UP:\n        event.stopPropagation();\n        event.preventDefault();\n\n        if (index > 0) {\n          index -= 1;\n        } else if (index === 0) {\n          index = results.length - 1;\n        }\n\n        if (scrollIndex > index) {\n          scrollIndex = index;\n        } else if (index === results.length - 1) {\n          scrollIndex = results.length - visibleItems;\n        }\n\n        this.handleScroll(scrollIndex * RESULT_ITEM_HEIGHT);\n        this.setState({selectedIndex: index});\n        break;\n      case KeyCodes.ARROW_DOWN:\n      case KeyCodes.TAB:\n        event.stopPropagation();\n        event.preventDefault();\n\n        if (index < results.length - 1) {\n          index += 1;\n        } else if (index === results.length - 1) {\n          index = 0;\n        }\n\n        if (index + 1 > scrollIndex + visibleItems) {\n          scrollIndex = index + 1 - visibleItems;\n        } else if (index === 0) {\n          scrollIndex = 0;\n        }\n\n        this.handleScroll(scrollIndex * RESULT_ITEM_HEIGHT);\n        this.setState({selectedIndex: index});\n        break;\n\n      case KeyCodes.ESC:\n        event.preventDefault();\n        this.handleClose();\n        break;\n\n      default:\n    }\n  };\n\n  handleScroll = (top) => this.refs.results.scrollTo(top);\n\n  handleDocumentClick = (event) => {\n    const modal = findDOMNode(this.refs.modal);\n    const modalRect = modal.getBoundingClientRect();\n    const coords = {\n      x: event.pageX || event.clientX,\n      y: event.pageY || event.clientY\n    };\n\n    if (!isInside(coords, modalRect)) {\n      this.handleClose();\n    }\n  };\n\n  render() {\n    const { isOpen, results, selectedIndex, query } = this.state;\n    const { intl } = this.context;\n\n    const resultsList = map(results, (result, index) => {\n      const resultClassName = classnames('results__item row', {\n        'results__item--active': selectedIndex === index\n      });\n\n      return (\n        <li className={resultClassName}\n            key={index}\n            onClick={() => this.handleDialogSelect(result.peerInfo.peer)}\n            onMouseOver={() => this.setState({selectedIndex: index})}>\n          <AvatarItem image={result.peerInfo.avatar}\n                      placeholder={result.peerInfo.placeholder}\n                      size=\"small\"\n                      title={result.peerInfo.title}/>\n          <div className=\"title col-xs\">\n            <div className=\"hint pull-right\">{intl.messages['modal.quickSearch.openDialog']}</div>\n            {result.peerInfo.title}\n          </div>\n        </li>\n      );\n    });\n\n    const modalStyle = {\n      content : {\n        position: null,\n        top: null,\n        left: null,\n        right: null,\n        bottom: null,\n        border: null,\n        background: null,\n        overflow: null,\n        outline: null,\n        padding: null,\n        borderRadius: null,\n        width: 460\n      }\n    };\n\n    return (\n      <Modal className=\"modal modal--quick-search\"\n             closeTimeoutMS={150}\n             isOpen={isOpen}\n             style={modalStyle}>\n        <div ref=\"modal\">\n\n          <header className=\"header\">\n            <div className=\"pull-left\">{intl.messages['modal.quickSearch.title']}</div>\n            <div className=\"pull-right\"><strong>esc</strong>&nbsp; {intl.messages['modal.quickSearch.toClose']}</div>\n            <div className=\"pull-right\"><strong>↵</strong>&nbsp; {intl.messages['modal.quickSearch.toSelect']}</div>\n            <div className=\"pull-right\"><strong>tab</strong>&nbsp; or &nbsp;<strong>↑</strong><strong>↓</strong>&nbsp; {intl.messages['modal.quickSearch.toNavigate']}</div>\n          </header>\n\n          <div className=\"input\">\n            <input type=\"text\"\n                   placeholder={intl.messages['modal.quickSearch.placeholder']}\n                   onChange={this.handleSearch}\n                   value={query}\n                   ref=\"query\"/>\n          </div>\n\n          <Scrollbar style={{height: RESULT_ITEM_HEIGHT * 8}} ref=\"results\">\n            <ul className=\"results\">\n              {\n                resultsList.length > 0\n                  ? resultsList\n                  : <li className=\"results__item results__item--suggestion row\">\n                      <FormattedHTMLMessage id=\"modal.quickSearch.notFound\"\n                                            values={{query}}/>\n                      <button className=\"button button--rised hide\">Create new dialog {query}</button>\n                    </li>\n              }\n            </ul>\n          </Scrollbar>\n        </div>\n      </Modal>\n    );\n  }\n\n}\n\nexport default Container.create(QuickSearch, {pure: false});\n"]}