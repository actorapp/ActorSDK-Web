{"version":3,"sources":["../../src/sdk/actor-sdk.js"],"names":[],"mappings":"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","file":"actor-sdk.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport 'babel-polyfill';\nimport 'setimmediate';\nimport initPollyfils from '../utils/polyfills';\n\nimport Actor from 'actor-js';\nimport DelegateContainer from '../utils/DelegateContainer';\nimport SharedContainer from '../utils/SharedContainer';\nimport PeerUtils from '../utils/PeerUtils';\nimport SDKDelegate from './actor-sdk-delegate';\nimport { endpoints, rootElement, homePage, twitter, helpPhone, appName } from '../constants/ActorAppConstants'\nimport Pace from 'pace';\nimport { isFunction } from 'lodash';\n\nimport React from 'react';\nimport { render } from 'react-dom';\nimport { Router, Route, IndexRoute, IndexRedirect } from 'react-router';\nimport history from '../utils/history';\nimport { IntlProvider } from 'react-intl';\nimport crosstab from 'crosstab';\nimport { lightbox } from '../utils/ImageUtils'\n\nimport LoginActionCreators from '../actions/LoginActionCreators';\nimport {loggerAppend} from '../actions/LoggerActionCreators';\nimport defaultLogHandler from '../utils/defaultLogHandler';\n\nimport LoginStore from '../stores/LoginStore';\n\nimport App from '../components/App.react';\nimport Main from '../components/Main.react';\nimport DefaultLogin from '../components/Login.react';\nimport DefaultDeactivated from '../components/Deactivated.react';\nimport DefaultJoin from '../components/Join.react';\nimport DefaultInstall from '../components/Install.react';\nimport DefaultArchive from '../components/Archive.react';\nimport DefaultDialog from '../components/Dialog.react';\nimport DefaultEmpty from '../components/Empty.react';\nimport Modal from 'react-modal';\n\nimport { extendL18n, getIntlData } from '../l18n';\n\nconst ACTOR_INIT_EVENT = 'INIT';\n\n// Init app loading progressbar\nPace.start({\n  ajax: false,\n  restartOnRequestAfter: false,\n  restartOnPushState: false\n});\n\n// Init lightbox\nlightbox.load({\n  animation: false,\n  controlClose: '<i class=\"material-icons\">close</i>'\n});\n\nwindow.isJsAppLoaded = false;\nwindow.jsAppLoaded = () => window.isJsAppLoaded = true;\n\n/**\n * Class represents ActorSKD itself\n *\n * @param {object} options - Object contains custom components, actions and localisation strings.\n */\nclass ActorSDK {\n  constructor(options = {}) {\n    this.endpoints = (options.endpoints && options.endpoints.length > 0) ? options.endpoints : endpoints;\n    this.logHandler = isFunction(options.logHandler) ? options.logHandler : this.createLogHandler();\n    this.isExperimental = options.isExperimental ? options.isExperimental : false;\n    this.forceLocale = options.forceLocale ? options.forceLocale : null;\n    this.rootElement = options.rootElement ? options.rootElement : rootElement;\n    this.homePage = options.homePage ? options.homePage : homePage;\n    this.twitter = options.twitter ? options.twitter : twitter;\n    this.helpPhone = options.helpPhone ? options.helpPhone : helpPhone;\n    this.appName = options.appName ? options.appName : appName;\n    this.delegate = options.delegate ? options.delegate : new SDKDelegate();\n\n    DelegateContainer.set(this.delegate);\n\n    if (this.delegate.l18n) extendL18n();\n\n    SharedContainer.set(this);\n  }\n\n  createLogHandler() {\n    if (localStorage.debug) {\n      return loggerAppend;\n    }\n\n    return defaultLogHandler;\n  }\n\n  _starter = () => {\n    if (crosstab.supported) {\n      crosstab.on(ACTOR_INIT_EVENT, (msg) => {\n        if (msg.origin !== crosstab.id && window.location.hash !== '#/deactivated') {\n          history.push('deactivated');\n        }\n      });\n    }\n\n    const appRootElemet = document.getElementById(this.rootElement);\n\n    if (window.location.hash !== '#/deactivated') {\n      if (crosstab.supported) crosstab.broadcast(ACTOR_INIT_EVENT, {});\n      window.messenger = Actor.create({\n        endpoints: this.endpoints,\n        logHandler: this.logHandler\n      });\n    }\n\n    const Login = (typeof this.delegate.components.login == 'function') ? this.delegate.components.login : DefaultLogin;\n    const Deactivated = (typeof this.delegate.components.deactivated == 'function') ? this.delegate.components.deactivated : DefaultDeactivated;\n    const Install = (typeof this.delegate.components.install == 'function') ? this.delegate.components.install : DefaultInstall;\n    const Archive = (typeof this.delegate.components.archive == 'function') ? this.delegate.components.archive : DefaultArchive;\n    const Join = (typeof this.delegate.components.join == 'function') ? this.delegate.components.join : DefaultJoin;\n    const Empty = (typeof this.delegate.components.empty == 'function') ? this.delegate.components.empty : DefaultEmpty;\n    const Dialog = (typeof this.delegate.components.dialog == 'function') ? this.delegate.components.dialog : DefaultDialog;\n    const intlData = getIntlData(this.forceLocale);\n\n    const requireAuth = (nextState, replaceState) => {\n      if (!LoginStore.isLoggedIn()) {\n        replaceState({\n          pathname: '/auth',\n          state: {nextPathname: nextState.location.pathname}\n        });\n      }\n    };\n\n    function checkPeer(nextState, replaceState) {\n      const peer = PeerUtils.stringToPeer(nextState.params.id);\n      if (!PeerUtils.hasPeer(peer)) {\n        console.error('Invalig peer', nextState);\n        replaceState('/im');\n      }\n    }\n\n    /**\n     * Method for pulling props to router components\n     *\n     * @param RoutedComponent component for extending\n     * @param props props to extend\n     * @returns {object} extended component\n     */\n    const createElement = (Component, props) => {\n      return <Component {...props} delegate={this.delegate} isExperimental={this.isExperimental}/>;\n    };\n\n    const root = (\n      <IntlProvider {...intlData}>\n        <Router history={history} createElement={createElement}>\n          <Route path=\"/\" component={App}>\n            <Route path=\"auth\" component={Login}/>\n            <Route path=\"deactivated\" component={Deactivated}/>\n            <Route path=\"install\" component={Install}/>\n            <Route path=\"join/:token\" component={Join} onEnter={requireAuth}/>\n\n            <Route path=\"im\" component={Main} onEnter={requireAuth}>\n              <Route path=\"archive\" component={Archive}/>\n              <Route path=\":id\" component={Dialog} onEnter={checkPeer}/>\n              <IndexRoute component={Empty}/>\n            </Route>\n\n            <IndexRedirect to=\"im\"/>\n          </Route>\n        </Router>\n      </IntlProvider>\n    );\n\n    render(root, appRootElemet);\n\n    // initial setup fot react modal\n    Modal.setAppElement(appRootElemet);\n\n    if (window.location.hash !== '#/deactivated') {\n      if (LoginStore.isLoggedIn()) LoginActionCreators.setLoggedIn({redirect: false});\n    }\n  };\n\n  /**\n   * Start application\n   */\n  startApp() {\n    const start = () => {\n      if (window.isJsAppLoaded) {\n        this._starter();\n      } else {\n        window.jsAppLoaded = this._starter;\n      }\n    };\n\n    initPollyfils(start);\n  }\n}\n\nexport default ActorSDK;\n"]}