{"version":3,"sources":["../../src/utils/alert.js"],"names":["alert","Alert","props","promise","Promise","resolve","SharedActor","get","intlData","forceLocale","handleKeyDown","bind","componentDidMount","toggleAutoFocus","refs","ok","focus","document","addEventListener","componentWillUnmount","removeEventListener","event","keyCode","ESC","preventDefault","renderDescription","description","render","message","okLabel","propTypes","node","isRequired","string","options","element","createElement","className","wrapper","body","appendChild","component","cleanup","setImmediate","remove","then"],"mappings":"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","file":"alert.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes, createElement } from 'react';\nimport { render, findDOMNode, unmountComponentAtNode } from 'react-dom';\nimport { KeyCodes } from '../constants/ActorAppConstants';\nimport ComposeActionCreators from '../actions/ComposeActionCreators';\nimport { IntlProvider, FormattedMessage } from 'react-intl';\nimport { getIntlData } from '../l18n';\nimport SharedContainer from '../utils/SharedContainer';\n\nclass Alert extends Component {\n  static propTypes = {\n    message: PropTypes.node.isRequired,\n    description: PropTypes.string,\n    okLabel: PropTypes.string\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.promise = new Promise((resolve) => {\n      this.resolve = resolve;\n    });\n\n    const SharedActor = SharedContainer.get();\n    this.intlData = getIntlData(SharedActor.forceLocale);\n\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n  }\n\n  componentDidMount() {\n    ComposeActionCreators.toggleAutoFocus(false);\n    findDOMNode(this.refs.ok).focus();\n    document.addEventListener('keydown', this.handleKeyDown, false);\n  }\n\n  componentWillUnmount() {\n    ComposeActionCreators.toggleAutoFocus(true);\n    document.removeEventListener('keydown', this.handleKeyDown, false);\n  }\n\n  handleKeyDown(event) {\n    if (event.keyCode === KeyCodes.ESC) {\n      event.preventDefault();\n      this.resolve();\n    }\n  }\n\n  renderDescription() {\n    const { description } = this.props;\n    if (!description) return null;\n\n    return (\n      <div className=\"modal__body\">{description}</div>\n    );\n  }\n\n  render() {\n    const { message, okLabel } = this.props;\n\n    return (\n      <IntlProvider {...this.intlData}>\n        <div className=\"modal\">\n\n          <div className=\"alert\">\n            <div className=\"modal__content\">\n\n              <header className=\"modal__header\">\n                <h1>{message}</h1>\n              </header>\n\n              {this.renderDescription()}\n\n              <footer className=\"modal__footer text-right\">\n                <button className=\"button button--lightblue\" onClick={this.resolve} ref=\"ok\">\n                  {okLabel ||<FormattedMessage id=\"button.ok\"/>}\n                </button>\n              </footer>\n\n            </div>\n          </div>\n\n        </div>\n      </IntlProvider>\n    );\n  }\n}\n\nexport default function alert(message, options = {})  {\n  let element = document.createElement('div');\n  element.className = 'modal-overlay';\n  const wrapper = document.body.appendChild(element);\n\n  const component = render(createElement(Alert, { message, ...options }), wrapper);\n\n  function cleanup() {\n    unmountComponentAtNode(wrapper);\n    setImmediate(() => wrapper.remove());\n  }\n\n  // Unmount component and remove it from DOM\n  component.promise.then(\n    () => cleanup(),\n    () => cleanup()\n  );\n\n  return component.promise;\n}\n"]}